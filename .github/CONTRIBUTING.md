# 開発ルール

## 作業手順
- 作業を始める前に最新のdevelopブランチをpullする。(mergeできていないタスクがなければcloneし直すのが安全)('git pull origin develop')または('git clone https://github.com/Kait-tt/capfes2017.git')。
- 作業用のブランチを切って移動する(例:'git checkout -b ◯◯')。
- 空のcommitを作成する(例:'git commit --allow-empty -m "コミットメッセージ"')。なお、コミットメッセージはこれから何をやるかを日本語で書くようにする。
- ↑で作った空のcommitをpushする(例:'git push -u origin ブランチ名')または('git push -u origin HEAD')。
- Github上でPullRequestを作成する(内容は後から修正できるので、その時点でわかっていることだけで良いです。テンプレートほぼそのまま残しておいても良い)。
- 作業用ブランチで作業を開始する。
- およそ30分毎にslackの「capfes2017-chat」チャンネルで進捗を報告する(これはゆるい感じでOK)。
- Issueのチェックボックスが１つ更新できるタイミングでpushし、PullRequestを更新する。
- Reviewを待つ間に次に進められる場合は、そのまま作業を続行する。
- Reviewが終わらないと次に進めない場合は、Reviewが終わるのを待つ。
- Reviewの結果、変更しなければならないものや不足があればそれを修正する。
- 修正したら再度Pushする。
- Reviewが終わり、developブランチにmergeされたら作業は終了

## 開発における注意点
- すべてのタスクの中で**レビューを最優先**にする。作業中のタスクが合っても、中断し、レビューを優先的に行う。
- タスクはIssueのチェックリスト毎に（基本的に）PRして報告する。
- いくらでも時間をかけられるタスクは、コストの範囲内で行う。
- タスクのコストはレビューの時間も含まれていることに注意する。
- 体調管理をしっかりする。
- **何かあったらすぐに報告する。**

## レビューについて
- レビュワーの設定（複数人指定可）
  - 素材→\*\*
  - コードが含まれているもの→ \*\*
  - 全体の変更に関わること→ \*\*
- アサインの設定
  - 基本的にレビュワーと同じ
  - レビュワーが複数人の場合は\*\*>\*\*>\*\*の順とする。
  - チェックリストの全ての項目がチェックされたら、最後にレビューした人がMergeする。
  
## タスクのアサインルール
- タスクをアサインする前にIssueを立てる
  - Issueにはタスクの完了条件毎にチェックボックスを設定し、すべてのチェックボックスが埋まったら作業が完了する状態にする。
  - チェックボックスの条件は、「どこまでやったら完了なのか」が明確になるように設定する。
  - 実装方法やデバッグ方法が不明瞭な場合は、方針を書く。
  - その他テンプレートに設定されている中から、必要な項目を書く。
- これまでの実績と残りの約束時間から、約束時間内に終了するだろうと思われるタスクをアサインする。
- 次にどのタスクをやれば良いのかわからなくなるので、一度に複数のタスクをアサインしてはいけない。

## ブランチ

### 運用規則

masterブランチとdevelopブランチは特殊な意味を持つ。  
masterブランチは動作可能な本番用ブランチとする。  
developブランチは動作可能で開発用ブランチとする。  
どちらのブランチにも、直接commitしてはならない。

開発者はdevelopブランチから派生ブランチを作り、そのブランチ上で開発を行う。  
開発が完了したら、派生ブランチのPull Request(PR)を作成する。  
レビュワーはレビューが完了したら、PR上で派生ブランチをdevelopへMergeする。  
Merge済みの使わないブランチは削除する。

### 命名規則

ブランチ名は英単語を並べたkabab-caseとする（例:`feature-shoot-bullet`）。  
ブランチ名からなんとなく変更内容が分かるようにする。長くなっても構わない。  
最初の単語は以下のような単語を用いる。
- `feature` : 何かの機能を実装する。
- `fix` : 何かを修正する。
- `add` : 何かを追加する。
- `implement` : 何かを実装する。

## ステージポリシー

Tacowasa（カンバン）では9つのステージを運用する。  
TODO, Doing, Reviewの3つのステージは、開発者ごとに持つ。すなわち、これらのステージに属するタスクは、必ず担当者を持つ。

以下にステージとその説明を列挙する。タスクは上から下（カンバン上では左から右）に推移していく。

- Memo: メモとしてのタスクや、プロジェクト期間内では実装しないタスクを置く。やるかやらないか分からないようなタスクもここに置く。
- Issue: 次回以降のイテレーションで行うタスクを置く。
- Backlog: 今回のイテレーションで行うタスクを置く。
- Ready: 今回のイテレーションで行うタスクのうち、更に直近で行い、まだアサインしていないタスクを置く。
- TODO: アサイン済みで未着状態のタスクを置く。
- Doing: アサイン済みで着手中のタスクを置く。
- Review: レビュー中のタスクを置く。タスクは実装者ではなく、レビュー担当者のReviewステージに置く。レビュー時に再度作業をする必要がある場合は、作業者のTODOステージまたはDoingステージへタスクを移動する。担当者が不明な場合はReadyステージへ移動する。
- Done: 今回のイテレーションの完了タスクを置く。
- Archive: 前回までのイテレーションの完了タスクを置く。

Doing, Reviewで作業をするときは、 *実働時間計測機能* により作業時間を記録する。記録ミスがある場合は、タスクダイアログにより修正する。

## Commit時の注意点

不要なファイルを追加してはならない。  
不要な変更を加えてはならない。作業内容に則さない変更（例えばフォーマットの修正）はなるべくcommitしない。  

`git add` 前に、 `git diff` や `git status` で変更ファイルや変更内容を確認すると、間違いが起こりにくい。

自分用のデバッグコードはPRを送る前に削除すること。ただし、動作確認の手段がデバッグ出力しか無ければ埋め込んでも良い。

## コーディングルール

### 命名規則

基本的に名前には UpperCamelCase を用いる（例:`HogePiyo`）。

以下の名前は lowerCamelCase を用いる（例:`hogePiyo`）。

- ローカル変数
- メンバ変数（ただしプロパティはUpperCamelCase）

以下の名前はすべて大文字にし、区切り記号は `-` とする（例:`HOGE_PIYO`）。

- 定数

複数形は用いず、リストを表す場合は末尾に `List` などを付ける。  
抽象クラスは `Abstract` を先頭に付ける。  
インターフェースは `I` を先頭に付ける。

### フォーマット

インデントはスペース4文字とし、タブは使わない。  
波括弧（`{}`）の前後は改行する。ただし、自動プロパティは1行で書く。  
コメント記号と文字の間には空白を一つ入れる。  
アクセス修飾子は必ず付ける。  
制御式の括弧の外側は空白を一つ入れる。メソッド定義またはメソッド呼び出しのときは詰めて書く。  
1行の長さはできるだけ80文字に抑え、超える場合は命令を分けるか、改行する。

```cs
// 説明用のサンプルクラス
namespace Capfes2017.Saple
{
    class Hoge
    {
        private int FooProperty { get; set; }
        private int fooMember;
        
        public int barProperty { get; private set; }
        public int barMember;
        
        private void FizzMethod()
        {
            for (int i = 0; i < 10; ++i)
            {
                if (i % 2 == 0)
                {
                    Debug.Log(i);
                }
            }
        }
        
        public void BuzzMethod()
        {
            // pass
        }
    }
}
```

基本的にRiderの推奨に従う。警告や推奨通知が表示されている場合は従うこと。  
ただし、上で指定されているフォーマットや命名規則とRiderのデフォルト推奨ルールが競合する場合は、設定を変更する。

コメントは基本的に必要ない。コメントが無くても読めるようなコードを書くことを心がける。  
ただし、そのようなコードを書くのが難しい、またはロジックが複雑な場合、あるいは他の人が引っかかりそうなライブラリの仕様を利用する場合は、コメントを書く。

## その他

- ドキュメントはイテレーションの区切りで更新する。
- Sceneを弄るときはSlackかGitHub上で宣言するとコンフリクトを回避できるかもしれない。
